# 機能詳細_FE-005 商品詳細API

## 1. API ID

`FE-005`

## 2. API名（エンドポイント）

**GET** `/api/products/{productId}`

## 3. API概要

指定された商品IDに対応する商品の詳細情報（名前・価格・在庫・説明文・画像一覧・レビュー集計など）を取得する。

## 4. リクエスト／レスポンス例

**Request**  
```
GET /api/products/123e4567-e89b-12d3-a456-426614174000
Authorization: Bearer <アクセストークン>
```

**Response**  
```json
{
  "productId": "123e4567-e89b-12d3-a456-426614174000",
  "name": "サンプル商品",
  "price": 1980,
  "stock": 42,
  "description": "<p>この商品は…</p>",
  "images": [
    "https://example.com/images/1.jpg",
    "https://example.com/images/2.jpg"
  ],
  "reviews": {
    "count": 123,
    "averageRating": 4.5
  }
}
```

## 5. フィールド定義

| 項目                   | データ型        | 必須 | 説明                                   | DBテーブル／カラム               |
|-----------------------|---------------|-----|--------------------------------------|-------------------------------|
| productId             | string        | O   | 商品ID（UUID）                        | 商品マスタ.product_id         |
| name                  | string        | O   | 商品名                                 | 商品マスタ.name               |
| price                 | integer       | O   | 価格（円）                             | 商品マスタ.price              |
| stock                 | integer       | O   | 在庫数                                 | 商品在庫.stock                |
| description           | string        | O   | 商品説明（HTML許容）                   | 商品マスタ.description        |
| images                | array<string> | O   | 画像URLリスト                          | 商品画像.image_url            |
| reviews.count         | integer       | O   | レビュー件数                           | 商品レビューテーブル集計      |
| reviews.averageRating | number        | O   | 平均評価（小数点1位）                   | 商品レビューテーブル集計      |

## 6. バリデーション

| 対象        | ルール                      | 発生タイミング     | メッセージID        |
|------------|----------------------------|------------------|-------------------|
| productId  | 必須、UUID形式             | リクエスト受信時   | MSG_VAL_PD_01     |
| name       | 必須、最大100文字          | データ取得後      | MSG_VAL_PD_02     |
| price      | 整数、>=0                  | データ取得後      | MSG_VAL_PD_03     |
| stock      | 整数、>=0                  | データ取得後      | MSG_VAL_PD_04     |
| description| 最小1文字、最大2000文字    | データ取得後      | MSG_VAL_PD_05     |
| images[*]  | URL形式、255文字以内       | データ取得後      | MSG_VAL_PD_06     |

## 7. シーケンスフロー

1. クライアントが商品詳細画面で `productId` を指定して GET リクエストを送信  
2. サーバー側で商品マスタ／在庫／画像／レビュー集計を結合して取得  
3. JSON レスポンスとして返却  
4. クライアントで各要素をバインドして描画  

## 8. 処理イベント

| イベント       | フロント処理                             | サーバーAPI                          | 成功時操作                         | エラー時操作                               |
|--------------|---------------------------------------|------------------------------------|----------------------------------|------------------------------------------|
| 画面初期表示   | スピナー表示 → GET 呼び出し                | GET `/api/products/{productId}`    | レスポンスデータを描画 → スピナー解除 | スピナー解除 → 「商品情報取得失敗」ダイアログ表示 |
| データ検証     | —                                     | バリデーションチェック             | —                                | エラー詳細をログ出力                       |
